<svg height="83.52mm" viewBox="0 0 1059.19 295.92" width="298.93mm" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><marker id="a" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#3465a4;fill-rule:evenodd;stroke:#3465a4;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="b" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#00f;fill-rule:evenodd;stroke:#3465a4;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="c" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#00f;fill-rule:evenodd;stroke:#3465a4;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="d" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#3465a4;fill-rule:evenodd;stroke:#3465a4;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="e" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#3465a4;fill-rule:evenodd;stroke:#3465a4;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="f" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#00f;fill-rule:evenodd;stroke:#00f;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="g" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#6ec814;fill-rule:evenodd;stroke:#6ec814;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="h" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#6ec814;fill-rule:evenodd;stroke:#6ec814;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="i" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#6ec814;fill-rule:evenodd;stroke:#6ec814;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="j" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#6ec814;fill-rule:evenodd;stroke:#6ec814;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="k" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#6ec814;fill-rule:evenodd;stroke:#6ec814;stroke-width:1pt" transform="scale(-.4)"/></marker><g style="fill:#00f;fill-rule:evenodd"><path d="m950.68 157.06v-103.9" style="stroke:#3465a4;stroke-dasharray:1 2"/><g style="stroke:#6ec814"><path d="m950.83 288.4v-131.44"/><path d="m586.5 288.58v-131.6"/><path d="m408.15 288.5v-131.6"/><path d="m238.24 288.84v-131.86"/></g></g><path d="m26.11 8h95v45.36h-95z" style="fill:none;stroke:#00f;stroke-width:1.1"/><path d="m235.01 91.83h-162.87" style="fill:#3465a4;fill-rule:evenodd;stroke:#3465a4;marker-start:url(#a)"/><path d="m72.29 157.51v-103.9" style="fill:#00f;fill-rule:evenodd;stroke:#3465a4"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="81.33" y="72">run until await</text><text x="261.72" y="205.65"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.15000001;word-spacing:0" x="38.35" y="33.85"><tspan style="font-weight:bold;font-size:12.5;font-family:Droid Sans;letter-spacing:-.15000001" x="38.35" y="33.85">Async Client</tspan></text><path d="m189.19 8.01h95v45.36h-95z" style="fill:none;stroke:#00f;stroke-width:1.1"/><text style="font-size:12.5;font-family:Droid Sans;letter-spacing:-.15000001;word-spacing:0" x="204.35" y="28"><tspan style="font-weight:bold" x="204.35" y="28">Async Local</tspan><tspan style="font-weight:bold" x="204.35" y="41.75">Variables</tspan></text><path d="m360.99 7.64h95v45.36h-95z" style="fill:none;stroke:#00f;stroke-width:1.1"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.15000001;word-spacing:0" x="394.79" y="33.76"><tspan style="font-weight:bold;font-size:12.5;font-family:Droid Sans;letter-spacing:-.15000001" x="394.79" y="33.76">Task</tspan></text><path d="m537.24 7.64h95v45.36h-95z" style="fill:none;stroke:#00f;stroke-width:1.1"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.15000001;word-spacing:0" x="542.56" y="33.76"><tspan style="font-weight:bold;font-size:12.5;font-family:Droid Sans;letter-spacing:-.15000001" x="542.56" y="33.76">TaskScheduler</tspan></text><path d="m712.75 7.64h95v45.36h-95z" style="fill:none;stroke:#00f;stroke-width:1.1"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.15000001;word-spacing:0" x="724.98" y="33.49"><tspan style="font-weight:bold;font-size:12.5;font-family:Droid Sans;letter-spacing:-.15000001" x="724.98" y="33.49">ThreadPool</tspan></text><path d="m899.34 7.64h107.39v45.36h-107.39z" style="fill:none;stroke:#00f;stroke-width:1.1"/><text style="font-size:12.5;font-family:Droid Sans;letter-spacing:-.15000001;word-spacing:0" x="906.33" y="28.43"><tspan style="font-weight:bold" x="906.33" y="28.43">Synchronization</tspan><tspan style="font-weight:bold" x="906.33" y="42.18">Context</tspan></text><path d="m238.32 157.12v-103.64" style="fill:#00f;fill-rule:evenodd;stroke:#3465a4"/><path d="m72.32 57.39h6.07v24.44h-6.07z" style="fill:none;stroke:#3465a4;stroke-width:1.1"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="103.32" y="88.58">save async locals</text><g style="stroke:#3465a4"><path d="m405.36 116.69h-332.71" style="fill:#3465a4;fill-rule:evenodd;marker-start:url(#b)"/><path d="m408.17 157.33v-104.17" style="fill:#00f;fill-rule:evenodd"/><path d="m408.34 116.33h6.07v16.72h-6.07z" style="fill:none;stroke-width:1.1"/></g><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="415.65" y="125.12">run until yield point</text><path d="m405.41 104.9h-332.71" style="fill:#3465a4;fill-rule:evenodd;stroke:#3465a4;marker-start:url(#c)"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="270.84" y="102.71">add continuation</text><path d="m586.51 157.17v-104.44" style="fill:#00f;fill-rule:evenodd;stroke:#3465a4"/><path d="m583.43 141.69h-175.25" style="fill:#3465a4;fill-rule:evenodd;stroke:#3465a4;marker-start:url(#d)"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="467.26" y="139.21">QueueTask</text><path d="m241.22 137.36h166.94" style="fill:#3465a4;fill-rule:evenodd;stroke:#3465a4;marker-start:url(#e)"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="268.96" y="134.31">save async locals</text><path d="m759.34 157.06v-103.9" style="fill:#00f;fill-rule:evenodd;stroke:#3465a4"/><path d="m756.39 146.96h-170.25" style="fill:#00f;fill-rule:evenodd;stroke:#3465a4;marker-start:url(#f)"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="642.34" y="144.86">submit to pool</text><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="2.76" y="159.62">new thread</text><g style="fill-rule:evenodd"><path d="m72.29 288.13v-131.6" style="fill:#00f;stroke:#6ec814"/><path d="m976.96 157.09h-914.92" style="fill:#0;stroke:#888a85;stroke-dasharray:6 2"/><path d="m404.75 171.63h-166.94" style="fill:#6ec814;stroke:#6ec814;marker-start:url(#g)"/></g><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="260.12" y="169.33">restore async locals</text><path d="m408.15 171.56h6.07v16.72h-6.07z" style="fill:none;stroke:#6ec814;stroke-width:1.1"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="415.29" y="182.89">finish task</text><path d="m948.22 201h-540.01" style="fill:#6ec814;fill-rule:evenodd;stroke:#6ec814;marker-start:url(#h)"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="640.84" y="199.16">post continuation</text><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0;fill:#f00" x="821.22" xml:space="preserve" y="127.99"><tspan x="821.22" y="127.99">sync ctx may be null,</tspan><tspan x="821.22" y="138.99">in which case continuations are directly </tspan><tspan x="821.22" y="149.99">handled by the task scheduler</tspan></text><path d="m759.3 288.06v-131.71" style="fill:#00f;fill-rule:evenodd;stroke:#6ec814;stroke-dasharray:1 2"/><path d="m950.92 203.56h6.07v26.3h-6.07z" style="fill:none;stroke:#6ec814;stroke-width:1.1"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="826.91" y="214.28"><tspan x="826.91" y="214.28">choose thread and env</tspan><tspan x="826.91" y="225.28">to run continuation</tspan></text><path d="m589.58 234.02h361.42" style="fill:#6ec814;fill-rule:evenodd;stroke:#6ec814;marker-start:url(#i)"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0;writing-mode:lr" x="676.41" y="232.09"><tspan>TryExecuteInline</tspan></text><path d="m240.76 239.14h345.56" style="fill:#6ec814;fill-rule:evenodd;stroke:#6ec814;marker-start:url(#j)"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="254.23" y="236.7">restore async locals</text><path d="m75.03 242.93h163.53" style="fill:#6ec814;fill-rule:evenodd;stroke:#6ec814;marker-start:url(#k)"/><text style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0" x="40.41" y="240.87">transfer control to continuation</text><path d="m72.44 247.71h6.07v16.72h-6.07z" style="fill:none;stroke:#6ec814;stroke-width:1.1"/><g style="font-size:10;font-family:Droid Sans Mono;letter-spacing:-.15000001;word-spacing:0"><text x="79.58" xml:space="preserve" y="259.04">finish </text><text style="fill:#f00" x="638.99" xml:space="preserve" y="250.78"><tspan x="638.99" y="250.78">if we cannot execute in the same thread</tspan><tspan x="638.99" y="261.78">then the task result will have to be marshalled</tspan><tspan x="638.99" y="272.78"> =&gt; slower</tspan></text></g></svg>