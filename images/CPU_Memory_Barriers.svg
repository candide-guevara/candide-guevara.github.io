<svg height="124.86mm" viewBox="0 0 758.42 442.42" width="214.04mm" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><marker id="a" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m2.31 0-3.46 2v-4z" style="fill:#696969;fill-rule:evenodd;stroke:#696969;stroke-width:.4pt"/></marker><marker id="b" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#32cd32;fill-rule:evenodd;stroke:#32cd32;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="c" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#696969;fill-rule:evenodd;stroke:#696969;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="d" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#696969;fill-rule:evenodd;stroke:#696969;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="e" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#f00;fill-rule:evenodd;stroke:#f00;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="f" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#f00;fill-rule:evenodd;stroke:#f00;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="g" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m2.31 0-3.46 2v-4z" style="fill:#32cd32;fill-rule:evenodd;stroke:#32cd32;stroke-width:.4pt"/></marker><marker id="h" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#696969;fill-rule:evenodd;stroke:#696969;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="i" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#696969;fill-rule:evenodd;stroke:#696969;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="j" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#696969;fill-rule:evenodd;stroke:#696969;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="k" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#696969;fill-rule:evenodd;stroke:#696969;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="l" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#f00;fill-rule:evenodd;stroke:#f00;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="m" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#1e90ff;fill-rule:evenodd;stroke:#1e90ff;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="n" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m2.31 0-3.46 2v-4z" style="fill:#1e90ff;fill-rule:evenodd;stroke:#1e90ff;stroke-width:.4pt"/></marker><marker id="o" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#1e90ff;fill-rule:evenodd;stroke:#1e90ff;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="p" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m2.31 0-3.46 2v-4z" style="fill:#1e90ff;fill-rule:evenodd;stroke:#1e90ff;stroke-width:.4pt"/></marker><marker id="q" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#696969;fill-rule:evenodd;stroke:#696969;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="r" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#f00;fill-rule:evenodd;stroke:#f00;stroke-width:1pt" transform="scale(-.4)"/></marker><marker id="s" orient="auto" refX="0" refY="0" style="overflow:visible"><path d="m5.77 0-8.65 5v-10z" style="fill:#696969;fill-rule:evenodd;stroke:#696969;stroke-width:1pt" transform="scale(-.4)"/></marker><g transform="translate(32.32 17.36)"><g transform="translate(-21.32 -49.33)"><path d="m67.24 79.71h124.95l-32.37 82.96h-126.65z" style="fill:none;stroke:#696969;stroke-width:1.1;stroke-miterlimit:10"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="69.71" y="91.78"><tspan style="font-size:10;font-family:DejaVu Sans Mono" x="69.71" y="91.78">mov %eax, (%edx)</tspan><tspan x="69.71" y="101.78"/><tspan style="font-size:10;font-family:DejaVu Sans Mono" x="69.71" y="111.78">mov %eax, (%ebx)</tspan><tspan x="69.71" y="121.78"/><tspan style="font-size:10;font-family:DejaVu Sans Mono" x="69.71" y="131.78">sfence</tspan><tspan x="69.71" y="141.78"/><tspan style="font-size:10;font-family:DejaVu Sans Mono" x="69.71" y="151.78">mov %ecx, (%ebx)</tspan></text></g><g style="fill:none"><g style="stroke:#008000;stroke-width:.95" transform="matrix(1 0 0 1.34 137.72 -340.6)"><path d="m209.41 276.35h95v55.03h-95z"/><path d="m209.2 289.76h94.91"/><path d="m209.2 303.72h94.91"/><path d="m209.38 317.68h94.91"/></g><g style="stroke-width:1.1"><path d="m195.31.91h492.43v293.71h-492.43z" style="stroke:#1e90ff;stroke-dasharray:6.6 2.2"/><g style="stroke:#32cd32"><path d="m523.75 18.67h95v55.03h-95z"/><path d="m523.54 32.08h94.91"/><path d="m523.54 46.04h94.91"/><path d="m523.72 60h94.91"/></g><path d="m204.63 19.49h123.02v108.4h-123.02z" style="stroke:#00f"/></g><path d="m197.93 141.29h489.64" style="stroke:#1e90ff;stroke-dasharray:6 6"/></g><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="201.58" y="11.51"><tspan x="201.58" y="11.51">Socket1 : Core1</tspan></text><g style="fill:none"><path d="m359.54 38.37h-223.9" style="stroke:#696969;marker-start:url(#c)"/><path d="m359.63 59.68h-223.9" style="stroke:#696969;marker-start:url(#d)"/><g style="stroke:#f00"><path d="m343.34 79.17h-260.59" style="marker-start:url(#e)"/><path d="m520.42 66.99h-79.04" style="marker-start:url(#f)"/></g></g><g style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0"><text x="208.89" y="30.45"><tspan x="208.89" y="30.45">Execution Units</tspan></text><text style="fill:#f00" x="208.28" y="88.91"><tspan x="208.28" y="88.91">Wait for Store Buffer to drain</tspan></text><text style="fill:#f00" x="447.62" y="76.13"><tspan x="447.62" y="76.13">flush to L1 cache</tspan></text><text x="345.92" y="27.41"><tspan x="345.92" y="27.41">Store Buffer</tspan></text><text x="202.8" y="152.86"><tspan x="202.8" y="152.86">Socket1 : Core2</tspan></text></g><g style="fill:none"><g style="stroke:#008000;stroke-width:.95" transform="matrix(1 0 0 1.34 138.94 -199.22)"><path d="m209.41 276.35h95v55.03h-95z"/><path d="m209.2 289.76h94.91"/><path d="m209.2 303.72h94.91"/><path d="m209.38 317.68h94.91"/></g><g style="stroke-width:1.1"><g style="stroke:#32cd32"><path d="m524.42 227.95h95v55.03h-95z"/><path d="m524.21 241.36h94.91"/><path d="m524.21 255.32h94.91"/><path d="m524.39 269.28h94.91"/></g><path d="m205.84 160.88h123.02v90.13h-123.02z" style="stroke:#00f"/></g></g><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="210.11" y="171.84"><tspan x="210.11" y="171.84">Execution Units</tspan></text><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="347.13" y="168.79"><tspan x="347.13" y="168.79">Store Buffer</tspan></text><path d="m612.68 153.02v-73.91" style="fill:none;stroke:#32cd32;stroke-width:2;marker-start:url(#b);marker-end:url(#g)"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="499.64" xml:space="preserve" y="101.96"><tspan x="499.64" y="101.96">Cache consistency protocol</tspan><tspan x="499.64" y="111.96">ensures data is the same </tspan><tspan x="499.64" y="121.96">across all cores caches</tspan></text><g transform="translate(-21.31 89.53)"><path d="m67.24 79.71h124.95l-32.37 82.96h-126.65z" style="fill:none;stroke:#696969;stroke-width:1.1;stroke-miterlimit:10"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="68.5" y="93.61"><tspan style="font-size:10;font-family:DejaVu Sans Mono" x="68.5" y="93.61">mov %eax, (%ebx)</tspan><tspan x="68.5" y="103.61"/><tspan style="font-size:10;font-family:DejaVu Sans Mono" x="68.5" y="113.61">mov (%ebx), %ecx</tspan><tspan x="68.5" y="123.61"/><tspan style="font-size:10;font-family:DejaVu Sans Mono" x="68.5" y="133.61">lfence</tspan><tspan x="68.5" y="143.61"/><tspan style="font-size:10;font-family:DejaVu Sans Mono" x="68.5" y="153.61">mov (%edx), %eax</tspan></text></g><g style="fill:none;stroke:#696969"><path d="m360.95 180.27h-225.22" style="marker-start:url(#h)"/><path d="m274.75 200.36h102.75" style="marker-start:url(#i)"/><path d="m527.66 233.14-58.2.16-.52 30.52-132.15.54v-24.97l-200.44.61" style="marker-start:url(#j)"/></g><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="213.39" y="196.89"><tspan x="213.39" y="196.89">Read from load buffer</tspan><tspan x="213.39" y="206.89">(inconsistent)</tspan></text><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="338.77" y="262.48"><tspan x="338.77" y="262.48">Load after cache lines states are</tspan><tspan x="338.77" y="272.48">updated</tspan></text><path d="m382.16 60.9-44.17 38.37h-200.44" style="fill:none;stroke:#696969;marker-start:url(#k)"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="214.98" y="109.01"><tspan x="214.98" y="109.01">Not write combining</tspan><tspan x="214.98" y="119.01">store will happend after</tspan></text><path d="m520.94 186.09-181.59 33.95h-256.45" style="fill:none;stroke:#f00;marker-start:url(#l)"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0;fill:#f00" x="213.98" y="218.22"><tspan x="213.98" y="218.22">Wait to drain</tspan><tspan x="213.98" y="228.22">invalidation queue</tspan></text><path d="m198.91 371.47h491.21v35.33h-491.21z" style="fill:none;stroke:#1e90ff;stroke-width:1.1;stroke-dasharray:6.6 2.2"/><path d="m509.68 324.58h123.02v20.71h-123.02z" style="fill:none;stroke:#00f;stroke-width:1.1"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="529.77" y="337.98"><tspan x="529.77" y="337.98">Socket Interconnect</tspan></text><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="205.17" y="384.87"><tspan x="205.17" y="384.87">Socket2</tspan></text><path d="m568.14 319.37v-19.42" style="fill:none;stroke:#1e90ff;stroke-width:2;marker-start:url(#m);marker-end:url(#n)"/><path d="m567.53 367.01v-17.87" style="fill:none;stroke:#1e90ff;stroke-width:2;marker-start:url(#o);marker-end:url(#p)"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="403.71" y="331.89"><tspan x="403.71" y="331.89">Cache coherent NUMA</tspan><tspan x="403.71" y="341.89">systems use a directory</tspan><tspan x="403.71" y="351.89">based coherence protocol</tspan></text><g style="fill:none;stroke:#008000;stroke-width:1.1"><path d="m524 158.28h95v55.03h-95z"/><path d="m523.79 171.69h94.91"/><path d="m523.79 185.65h94.91"/><path d="m523.97 199.61h94.91"/></g><g style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0"><text x="523.32" y="154.59"><tspan x="523.32" y="154.59">Invalidation queue</tspan></text><text x="532.63" y="168.28"><tspan style="fill:#f00" x="532.63" y="168.28">Cache line INVALID</tspan></text><text x="523.32" y="15.51"><tspan x="523.32" y="15.51">L1 data cache</tspan></text></g><g transform="translate(-167.66 162.78)"><path d="m187.49-47.62-16.12 30.66 33.83 38.33" style="fill:none;stroke:#696969;marker-start:url(#q);marker-end:url(#a)"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="178.49" y="-21.88"><tspan x="178.49" y="-21.88">Suppose (%edx) and (%ebx)</tspan><tspan x="178.49" y="-11.88">are the same in both cores</tspan></text></g><path d="m620.02 226.86 16.63-23.54-17.38-38.87" style="fill:none;stroke:#f00;marker-start:url(#r)"/><text style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0" x="534.85" y="237.73"><tspan style="fill:#f00" x="534.85" y="237.73">Cache line INVALID</tspan></text><path d="m676.83 234.81h-58.56" style="fill:none;stroke:#696969;marker-start:url(#s)"/><g style="font-size:10;font-family:Droid Sans;letter-spacing:-.5;word-spacing:0"><text x="631.18" xml:space="preserve" y="244.93"><tspan x="631.18" y="244.93">Fetch from </tspan><tspan x="631.18" y="254.93">memory or </tspan><tspan x="631.18" y="264.93">other cache</tspan></text><text x="526.86" y="28.97"><tspan style="fill:#f00" x="526.86" y="28.97">Cache line MODIFIED</tspan></text></g></g></svg>